user snap_daemon snap_daemon;
worker_processes auto;
pid {{ snap_common }}/run/nginx.pid;

events {
        worker_connections 768;
}

http {
        ##
        # Basic Settings
        ##

        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;
        # Disabled for glance image uploads. The maximum size will be
        # determined by glance settings.
        # TODO(wolsen): should the scope be narrowed to horizon/glance?
        client_max_body_size 0;
        proxy_buffering off;
        proxy_request_buffering off;

        include {{ snap }}/usr/conf/mime.types;
        default_type application/octet-stream;

        ##
        # Logging Settings
        ##

{% if logging_debug|lower == "true" %}
        error_log {{ snap_common }}/log/nginx-error.log debug;
{% else %}
        error_log {{ snap_common }}/log/nginx-error.log;
{% endif %}
        access_log {{ snap_common }}/log/nginx-access.log;

        ##
        # Gzip Settings
        ##

        gzip on;
        gzip_disable "msie6";

        include {{ snap_common }}/etc/nginx/conf.d/*.conf;
        include {{ snap_common }}/etc/nginx/sites-enabled/*;
}
